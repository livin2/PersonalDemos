## 伪代码

### :newFile

```
dev.newFile：
{
	在当前目录下检查名字是否已被使用
		已使用返回false
   请求分配一个文件索引结点
		分配失败返回false
	将文件名-文件索引节点号的键对放入目录
		返回true
}
```

```
dev文件索引结点分配:
{
	检查空闲文件索引节点号表
		无空闲返回false
	请求分配一个块(返回空闲块的块号)
		分配失败返回false
	从文件索引节点号表取出头部结点
	根据文件索引节点号取到文件索引节点
	将分配的空闲块号分配给此文件索引节点
	空闲块数—
	返回true
}
```

```
dev块分配:
{
	检查当前设备中的空闲块号表
 		无空闲返回false
 	取出并返回头部空闲块号
	空闲块数—
	返回true
}
```

### :deleteFile

```
dev.deleteFile：
{
 	在当前目录下查找文件名
		找不出输出错误信息并返回false
	根据文件名检索到的文件索引节点号取到文件索引节点
	调用文件索引节点的释放函数
	将此文件名-索引节点号键值对从当前目录删除
	返回true
}
```

```
dev文件索引节点释放:
{
	遍历块号链表，根据块号检索块并释放所有块
	清空块号链表
	将文件索引号放会空闲文件索引号表
	空闲文件索引结点数++
	返回true
}
```

```
dev块释放:
{
	将本块号放入空闲块号表
	空闲块数++
	返回true
}
```

### :open

```
open:
{
 	调用打开子目录函数
 		成功则返回true
 	在当前目录下查找文件名
		找不出输出错误信息并返回false
 	检查内存索引节点表若此文件已经存在于内存中
 		已经打开，返回true
 	比较内存空闲块数与文件拥有的块数
 		内存空闲块数不足，输出错误信息返回false
 	调用内存的索引节点分配函数	
 		分配失败返回false
 	将设备索引节点中的文件大小，所有者信息拷贝给分配的内存索引节点
 	遍历设备块号链表，对于每个设备块在内存中为内存索引节点分配一个新的空闲块，将设备块数据复制至新分配内存块中，将此内存块链入内存索引节点的块链表
 	
  	将文件名-内存索引节点号的键值对放入内存索引节点表
 	返回true
}
```

```
子目录打开
{
   根据名字查找子目录的目录节点号
 	  找不到返回false
  将curMenui压栈
  当前目录curMenui赋值为子目录的目录节点号
}
```

### :close

```
close:
{
 	检查内存索引节点表若此文件不存在于内存中
 		文件已关闭，函数返回
 	调用写回函数将内存中的文件写入设备中
	释放内存索引节点
 	将文件名-内存索引节点号的键值对从内存索引节点表中删除
}
```

```
writeBack:
{
 	比较内存索引节点的块数与设备索引节点块数+设备空闲块数大小
   		设备块数不足，输出错误信息返回false
 	将内存索引结点块号表的中块的数据逐份复制进设备索引节点拥有的块中(覆盖写)
 	若设备索引节点的块号表到达尾部则为其分配新的块
    若在内存索引节点块号表到达尾部时设备索引节点块号表未到达尾部，则表明产生碎片，则将后续的块释放。
}
```

### :read

```
{
 	在内存索引节点表中检索文件名
 		未找到：文件未打开：输出错误信息 返回false
 	根据块号表遍历所有块读出数据
 	返回true
}
```

### :write

```
{
 	在内存索引节点表中检索文件名
 		未找到：文件未打开：输出错误信息 返回false
 	比对当前登陆用户与文件拥有者
 		非文件拥有者：没有写权限：输出错误信息 返回false
 	循环从输入流中读入数据直到读入终止符
 	{
 		并逐个写入内存索引结点拥有的块中
 	 	当到达块号表尾部且尾部块写满则请求分配新的块
 			分配失败：输出错误信息：返回false
 		分配成功：文件大小++（以块数为单位）
 	}
 	结束写入后 如果未到达内存索引节点块号表尾部表明产生碎片
 	则释放后续内存块
 	Return true
}
```

